
if not game:IsLoaded() then
  game.Loaded:Wait()
end

if _G.KinayoScriptsLoaded then
    return
end

_G.KinayoScriptsLoaded = true

local HttpService = game:GetService("HttpService")

local onMessage = function(message)
  game:GetService("StarterGui"):SetCore("SendNotification", {
      Title = "Status",
      Text = message
  })
end

local API_URL = "https://kinayo8.pythonanywhere.com"
local fRequest = request or http_request or syn_request

local function getHWID()
    return gethwid()
end

local function getScaleFactor()
    local viewportSize = workspace.CurrentCamera.ViewportSize
    local baseScale = math.clamp(math.min(viewportSize.X/1920, viewportSize.Y/1080), 0.8, 1.5)
    return baseScale * 1.2
end

local scaleFactor = getScaleFactor()

local discordLink = "https://discord.gg/SdWZ9srXJe"

local Players = game:GetService("Players")
local Player = Players.LocalPlayer

local gameName = "Pixel Blade"

if not isfolder("kinayosave") then
    makefolder("kinayosave")
end

if not isfolder("kinayosave/"..gameName) then
  makefolder("kinayosave/"..gameName)
end

local KeySystemGui = Instance.new("ScreenGui")
KeySystemGui.Name = "KeySystem"
KeySystemGui.Parent = Player.PlayerGui
KeySystemGui.DisplayOrder = 999999999
KeySystemGui.ResetOnSpawn = false

local KeyFrame = Instance.new("ImageLabel")
KeyFrame.Name = "KeyFrame"
KeyFrame.Size = UDim2.new(0, 200, 0, 150)
KeyFrame.AnchorPoint = Vector2.new(0.5, 0.5)
KeyFrame.Position = UDim2.new(0.5, 0, 0.5, 0) 
KeyFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
KeyFrame.BackgroundTransparency = 0.4
KeyFrame.ImageTransparency = 0.5
KeyFrame.BorderSizePixel = 0
KeyFrame.Image = "rbxassetid://9240529838"
KeyFrame.ScaleType = Enum.ScaleType.Stretch
KeyFrame.Parent = KeySystemGui

local keyUIScale = Instance.new("UIScale")
keyUIScale.Scale = scaleFactor
keyUIScale.Parent = KeyFrame

local UICorner = Instance.new("UICorner")
UICorner.CornerRadius = UDim.new(0, 12)
UICorner.Parent = KeyFrame

local UIStroke = Instance.new("UIStroke") 
UIStroke.Color = Color3.fromRGB(147, 112, 219)
UIStroke.Thickness = 2
UIStroke.Parent = KeyFrame

local function HSVtoRGB(h, s, v)
    local r, g, b
    
    local i = math.floor(h * 6)
    local f = h * 6 - i
    local p = v * (1 - s)
    local q = v * (1 - f * s)
    local t = v * (1 - (1 - f) * s)
    
    i = i % 6
    
    if i == 0 then r, g, b = v, t, p
    elseif i == 1 then r, g, b = q, v, p
    elseif i == 2 then r, g, b = p, v, t
    elseif i == 3 then r, g, b = p, q, v
    elseif i == 4 then r, g, b = t, p, v
    elseif i == 5 then r, g, b = v, p, q
    end
    
    return Color3.new(r, g, b)
end

task.spawn(function()
    local hue = 0
    while true do
        if not KeyFrame or not KeyFrame.Parent then break end
        UIStroke.Color = HSVtoRGB(hue, 0.8, 1)
        hue = (hue + 0.005) % 1
        task.wait(0.03)
    end
end)

local Title = Instance.new("TextLabel")
Title.Name = "Title"
Title.Size = UDim2.new(1, 0, 0, 30)
Title.Position = UDim2.new(0, 0, 0, 0)
Title.BackgroundTransparency = 1
Title.Text = "Kinayo Key System"
Title.Font = Enum.Font.GothamBold
Title.TextColor3 = Color3.fromRGB(255, 255, 255)
Title.TextSize = 16
Title.Parent = KeyFrame

local KeyBox = Instance.new("TextBox")
KeyBox.Name = "KeyBox"
KeyBox.Size = UDim2.new(0.8, 0, 0, 25)
KeyBox.Position = UDim2.new(0.1, 0, 0.23, 0)
KeyBox.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
KeyBox.BackgroundTransparency = 0.5
KeyBox.Text = ""
KeyBox.PlaceholderText = "Enter Key"
KeyBox.TextColor3 = Color3.fromRGB(255, 255, 255)
KeyBox.Font = Enum.Font.Gotham
KeyBox.TextSize = 14
KeyBox.Parent = KeyFrame

local UICorner_2 = Instance.new("UICorner")
UICorner_2.CornerRadius = UDim.new(0, 8)
UICorner_2.Parent = KeyBox

local DiscordButton = Instance.new("TextButton")
DiscordButton.Name = "DiscordButton"
DiscordButton.Size = UDim2.new(0.8, 0, 0, 25)
DiscordButton.Position = UDim2.new(0.1, 0, 0.42, 0)
DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
DiscordButton.BackgroundTransparency = 0.2
DiscordButton.Text = "Copy Discord"
DiscordButton.Font = Enum.Font.Gotham
DiscordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DiscordButton.TextSize = 14
DiscordButton.Parent = KeyFrame

local UICorner_3 = Instance.new("UICorner")
UICorner_3.CornerRadius = UDim.new(0, 8)
UICorner_3.Parent = DiscordButton

local ResetHWIDButton = Instance.new("TextButton")
ResetHWIDButton.Name = "ResetHWIDButton" 
ResetHWIDButton.Size = UDim2.new(0.8, 0, 0, 25)
ResetHWIDButton.Position = UDim2.new(0.1, 0, 0.61, 0)
ResetHWIDButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
ResetHWIDButton.BackgroundTransparency = 0.6
ResetHWIDButton.Text = "Reset HWID"
ResetHWIDButton.Font = Enum.Font.Gotham
ResetHWIDButton.TextColor3 = Color3.fromRGB(255, 255, 255)
ResetHWIDButton.TextSize = 14
ResetHWIDButton.Parent = KeyFrame

local UICorner_5 = Instance.new("UICorner")
UICorner_5.CornerRadius = UDim.new(0, 8)
UICorner_5.Parent = ResetHWIDButton

local VerifyButton = Instance.new("TextButton")
VerifyButton.Name = "VerifyButton"
VerifyButton.Size = UDim2.new(0.8, 0, 0, 25)
VerifyButton.Position = UDim2.new(0.1, 0, 0.8, 0)
VerifyButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
VerifyButton.BackgroundTransparency = 0.6
VerifyButton.Text = "Verify Key"
VerifyButton.Font = Enum.Font.Gotham
VerifyButton.TextColor3 = Color3.fromRGB(255, 255, 255)
VerifyButton.TextSize = 14
VerifyButton.Parent = KeyFrame

local UICorner_4 = Instance.new("UICorner")
UICorner_4.CornerRadius = UDim.new(0, 8)
UICorner_4.Parent = VerifyButton

DiscordButton.MouseButton1Click:Connect(function()
   DiscordButton.BackgroundColor3 = Color3.fromRGB(120, 130, 255)
   setclipboard(discordLink)
   onMessage("Discord link copied!")
   task.wait(0.1)
   DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
end)

ResetHWIDButton.MouseButton1Click:Connect(function()
   ResetHWIDButton.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
   onMessage("To reset your key, you need to open a HWID reset ticket in the official Discord channel!")
   task.wait(0.1)
   ResetHWIDButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
end)

local function getRandomBackgroundImageId()
    local imageIds = {
        "15864494545", 
        "14196530715", 
        "14475650159", 
        "14020362767"
    }
    return "rbxassetid://" .. imageIds[math.random(1, #imageIds)]
end

local function loadMainScript()
    KeySystemGui:Destroy()
    
    local SETTINGS_FILE = "kinayosave/" .. gameName .. "/settings.json"
    
    local function saveSettings(settings)
        local success, err = pcall(function()
            writefile(SETTINGS_FILE, HttpService:JSONEncode(settings))
        end)
    end
    
    local function loadSettings()
    if isfile(SETTINGS_FILE) then
        local success, data = pcall(function()
            return HttpService:JSONDecode(readfile(SETTINGS_FILE))
        end)
        if success and data then
            return data
        end
    end
    return {
        autoFarmEnabled = false,
        autoAttackEnabled = false,
        autoChestEnabled = false,
        autoBuffEnabled = false,
        autoSkillEnabled = false,
        autoPotionEnabled = false,
        potionHealthThreshold = 50,
        usePotion1 = false,
        usePotion2 = false,
        mobDistance = 8,
        farmSpeed = 25,
        renderDisabled = false
    }
end
    
    local savedSettings = loadSettings()
    
    local ReplicatedStorage = game:GetService("ReplicatedStorage")
    local Workspace = game:GetService("Workspace")
    local TweenService = game:GetService("TweenService")
    local RunService = game:GetService("RunService")
    local VirtualInputManager = game:GetService("VirtualInputManager")
    local LocalPlayer = Players.LocalPlayer
    
    local nearestMob = nil
    local autoFarmEnabled = savedSettings.autoFarmEnabled or false
    local autoAttackEnabled = savedSettings.autoAttackEnabled or false
    local autoChestEnabled = savedSettings.autoChestEnabled or false
    local autoBuffEnabled = savedSettings.autoBuffEnabled or false
    local autoSkillEnabled = savedSettings.autoSkillEnabled or false
    local autoPotionEnabled = savedSettings.autoPotionEnabled or false
local potionHealthThreshold = savedSettings.potionHealthThreshold or 50
local usePotion1 = savedSettings.usePotion1 or false
local usePotion2 = savedSettings.usePotion2 or false
    local farmSpeed = savedSettings.farmSpeed or 25
    local mobDistance = savedSettings.mobDistance or 8
    local renderDisabled = savedSettings.renderDisabled or false
    
    local ScreenGui = Instance.new("ScreenGui")
    ScreenGui.Name = "KinayoScripts"
    ScreenGui.Parent = Player.PlayerGui
    ScreenGui.ResetOnSpawn = false
    ScreenGui.DisplayOrder = 999999999
    ScreenGui.IgnoreGuiInset = true
    
    local ToggleButton = Instance.new("ImageButton")
    ToggleButton.Name = "ToggleButton"
    ToggleButton.Size = UDim2.new(0, 30, 0, 30)
    ToggleButton.AnchorPoint = Vector2.new(0.5, 0)
    ToggleButton.Position = UDim2.new(0.5, 0, 0, 5)
    ToggleButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    ToggleButton.BackgroundTransparency = 0.6
    ToggleButton.Parent = ScreenGui
    ToggleButton.Image = "rbxassetid://15897842087"
    ToggleButton.ImageTransparency = 0.6
    
    local toggleUIScale = Instance.new("UIScale")
    toggleUIScale.Scale = scaleFactor
    toggleUIScale.Parent = ToggleButton
    
    local ToggleLabel = Instance.new("TextLabel")
    ToggleLabel.Name = "ToggleLabel"
    ToggleLabel.Size = UDim2.new(1, 0, 1, 0)
    ToggleLabel.BackgroundTransparency = 1
    ToggleLabel.Text = "K"
    ToggleLabel.Font = Enum.Font.SourceSansBold
    ToggleLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    ToggleLabel.TextSize = 18
    ToggleLabel.Parent = ToggleButton
    
    local UICorner_Toggle = Instance.new("UICorner")
    UICorner_Toggle.CornerRadius = UDim.new(0.3, 0)
    UICorner_Toggle.Parent = ToggleButton
    
    local MainFrame = Instance.new("ImageLabel")
MainFrame.Name = "MainFrame"
MainFrame.Size = UDim2.new(0, 240, 0, 280)
MainFrame.AnchorPoint = Vector2.new(0.5, 0.5)
MainFrame.Position = UDim2.new(0.5, 0, 0.5, 0)
MainFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
MainFrame.BackgroundTransparency = 0.4
MainFrame.ImageTransparency = 0.5
MainFrame.BorderSizePixel = 0
MainFrame.Image = getRandomBackgroundImageId()
MainFrame.ScaleType = Enum.ScaleType.Stretch
MainFrame.Parent = ScreenGui
    
    local mainUIScale = Instance.new("UIScale")
    mainUIScale.Scale = scaleFactor
    mainUIScale.Parent = MainFrame
    
    local MainStroke = Instance.new("UIStroke")
    MainStroke.Color = Color3.fromRGB(147, 112, 219)
    MainStroke.Thickness = 2
    MainStroke.Parent = MainFrame
    
    task.spawn(function()
        local hue = 0
        while true do
            if not MainFrame or not MainFrame.Parent then break end
            MainStroke.Color = HSVtoRGB(hue, 0.8, 1)
            hue = (hue + 0.005) % 1
            task.wait(0.03)
        end
    end)
    
    local UICorner = Instance.new("UICorner")
    UICorner.CornerRadius = UDim.new(0, 12)
    UICorner.Parent = MainFrame
    
    local Title = Instance.new("TextLabel")
    Title.Name = "Title"
    Title.Size = UDim2.new(1, 0, 0, 22)
    Title.Position = UDim2.new(0, 0, 0, 0)
    Title.BackgroundTransparency = 1
    Title.Text = "Kinayo Scripts"
    Title.Font = Enum.Font.SourceSansBold
    Title.TextColor3 = Color3.fromRGB(255, 255, 255)
    Title.TextSize = 20
    Title.Parent = MainFrame
    
    local SubTitle = Instance.new("TextLabel")
    SubTitle.Name = "SubTitle"
    SubTitle.Size = UDim2.new(1, 0, 0, 16)
    SubTitle.Position = UDim2.new(0, 0, 0.075, 0)
    SubTitle.BackgroundTransparency = 1
    SubTitle.Text = gameName
    SubTitle.Font = Enum.Font.SourceSansItalic
    SubTitle.TextColor3 = Color3.fromRGB(200, 200, 200)
    SubTitle.TextSize = 15
    SubTitle.Parent = MainFrame
    
    local DiscordButton = Instance.new("TextButton")
    DiscordButton.Name = "DiscordButton"
    DiscordButton.Size = UDim2.new(0, 40, 0, 20)
    DiscordButton.Position = UDim2.new(1, -45, 0, 5)
    DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    DiscordButton.BackgroundTransparency = 0.2
    DiscordButton.Text = "Discord"
    DiscordButton.Font = Enum.Font.Gotham
    DiscordButton.TextColor3 = Color3.fromRGB(255, 255, 255)
    DiscordButton.TextSize = 12
    DiscordButton.Parent = MainFrame
    
    local UICorner_Discord = Instance.new("UICorner")
    UICorner_Discord.CornerRadius = UDim.new(0, 6)
    UICorner_Discord.Parent = DiscordButton
    
    local AutoFarmButton = Instance.new("TextButton")
AutoFarmButton.Name = "AutoFarmButton"
AutoFarmButton.Size = UDim2.new(0.43, 0, 0, 30)
AutoFarmButton.Position = UDim2.new(0.05, 0, 0.17, 0)
AutoFarmButton.BackgroundColor3 = autoFarmEnabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
AutoFarmButton.BackgroundTransparency = 0.6
AutoFarmButton.Text = "Auto Farm"
AutoFarmButton.Font = Enum.Font.Gotham
AutoFarmButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoFarmButton.TextSize = 12
AutoFarmButton.Parent = MainFrame
    
    local UICorner_AutoFarm = Instance.new("UICorner")
    UICorner_AutoFarm.CornerRadius = UDim.new(0, 8)
    UICorner_AutoFarm.Parent = AutoFarmButton
    
    local AutoAttackButton = Instance.new("TextButton")
AutoAttackButton.Name = "AutoAttackButton"
AutoAttackButton.Size = UDim2.new(0.43, 0, 0, 30)
AutoAttackButton.Position = UDim2.new(0.52, 0, 0.17, 0)
AutoAttackButton.BackgroundColor3 = autoAttackEnabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
AutoAttackButton.BackgroundTransparency = 0.6
AutoAttackButton.Text = "Auto Attack"
AutoAttackButton.Font = Enum.Font.Gotham
AutoAttackButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoAttackButton.TextSize = 12
AutoAttackButton.Parent = MainFrame
    
    local UICorner_AutoAttack = Instance.new("UICorner")
    UICorner_AutoAttack.CornerRadius = UDim.new(0, 8)
    UICorner_AutoAttack.Parent = AutoAttackButton
    
    local AutoChestButton = Instance.new("TextButton")
AutoChestButton.Name = "AutoChestButton"
AutoChestButton.Size = UDim2.new(0.43, 0, 0, 30)
AutoChestButton.Position = UDim2.new(0.285, 0, 0.41, 0)
AutoChestButton.BackgroundColor3 = autoChestEnabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
AutoChestButton.BackgroundTransparency = 0.6
AutoChestButton.Text = "Auto Chest"
AutoChestButton.Font = Enum.Font.Gotham
AutoChestButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoChestButton.TextSize = 12
AutoChestButton.Parent = MainFrame
    
    local UICorner_AutoChest = Instance.new("UICorner")
    UICorner_AutoChest.CornerRadius = UDim.new(0, 8)
    UICorner_AutoChest.Parent = AutoChestButton
    
    local AutoBuffButton = Instance.new("TextButton")
AutoBuffButton.Name = "AutoBuffButton"
AutoBuffButton.Size = UDim2.new(0.43, 0, 0, 30)
AutoBuffButton.Position = UDim2.new(0.52, 0, 0.29, 0)
AutoBuffButton.BackgroundColor3 = autoBuffEnabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
AutoBuffButton.BackgroundTransparency = 0.6
AutoBuffButton.Text = "Auto Buff"
AutoBuffButton.Font = Enum.Font.Gotham
AutoBuffButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoBuffButton.TextSize = 12
AutoBuffButton.Parent = MainFrame
    
    local UICorner_AutoBuff = Instance.new("UICorner")
    UICorner_AutoBuff.CornerRadius = UDim.new(0, 8)
    UICorner_AutoBuff.Parent = AutoBuffButton
    
    local AutoSkillButton = Instance.new("TextButton")
AutoSkillButton.Name = "AutoSkillButton"
AutoSkillButton.Size = UDim2.new(0.43, 0, 0, 30)
AutoSkillButton.Position = UDim2.new(0.05, 0, 0.29, 0)
AutoSkillButton.BackgroundColor3 = autoSkillEnabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
AutoSkillButton.BackgroundTransparency = 0.6
AutoSkillButton.Text = "Auto Skill"
AutoSkillButton.Font = Enum.Font.Gotham
AutoSkillButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoSkillButton.TextSize = 12
AutoSkillButton.Parent = MainFrame

local UICorner_AutoSkill = Instance.new("UICorner")
UICorner_AutoSkill.CornerRadius = UDim.new(0, 8)
UICorner_AutoSkill.Parent = AutoSkillButton

local AutoPotionButton = Instance.new("TextButton")
AutoPotionButton.Name = "AutoPotionButton"
AutoPotionButton.Size = UDim2.new(0.43, 0, 0, 30)
AutoPotionButton.Position = UDim2.new(0.285, 0, 0.53, 0)
AutoPotionButton.BackgroundColor3 = autoPotionEnabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
AutoPotionButton.BackgroundTransparency = 0.6
AutoPotionButton.Text = "Auto Potion"
AutoPotionButton.Font = Enum.Font.Gotham
AutoPotionButton.TextColor3 = Color3.fromRGB(255, 255, 255)
AutoPotionButton.TextSize = 12
AutoPotionButton.Parent = MainFrame

local UICorner_AutoPotion = Instance.new("UICorner")
UICorner_AutoPotion.CornerRadius = UDim.new(0, 8)
UICorner_AutoPotion.Parent = AutoPotionButton

local PotionFrame = Instance.new("Frame")
PotionFrame.Name = "PotionFrame"
PotionFrame.Size = UDim2.new(0, 200, 0, 280)
PotionFrame.Position = UDim2.new(1, 10, 0, 0)
PotionFrame.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
PotionFrame.BackgroundTransparency = 0.4
PotionFrame.BorderSizePixel = 0
PotionFrame.Visible = false
PotionFrame.Parent = MainFrame

local potionUIScale = Instance.new("UIScale")
potionUIScale.Scale = 1
potionUIScale.Parent = PotionFrame

local PotionCorner = Instance.new("UICorner")
PotionCorner.CornerRadius = UDim.new(0, 12)
PotionCorner.Parent = PotionFrame

local PotionStroke = Instance.new("UIStroke")
PotionStroke.Color = Color3.fromRGB(147, 112, 219)
PotionStroke.Thickness = 2
PotionStroke.Parent = PotionFrame

task.spawn(function()
    local hue = 0
    while true do
        if not PotionFrame or not PotionFrame.Parent then break end
        PotionStroke.Color = HSVtoRGB(hue, 0.8, 1)
        hue = (hue + 0.005) % 1
        task.wait(0.03)
    end
end)

local PotionTitle = Instance.new("TextLabel")
PotionTitle.Name = "PotionTitle"
PotionTitle.Size = UDim2.new(1, 0, 0, 30)
PotionTitle.Position = UDim2.new(0, 0, 0, 10)
PotionTitle.BackgroundTransparency = 1
PotionTitle.Text = "Potion Settings"
PotionTitle.Font = Enum.Font.GothamBold
PotionTitle.TextColor3 = Color3.fromRGB(255, 255, 255)
PotionTitle.TextSize = 16
PotionTitle.Parent = PotionFrame

local HealthLabel = Instance.new("TextLabel")
HealthLabel.Name = "HealthLabel"
HealthLabel.Size = UDim2.new(0.9, 0, 0, 20)
HealthLabel.Position = UDim2.new(0.05, 0, 0.15, 0)
HealthLabel.BackgroundTransparency = 1
HealthLabel.Text = "Health Threshold: " .. potionHealthThreshold .. "%"
HealthLabel.Font = Enum.Font.Gotham
HealthLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
HealthLabel.TextSize = 12
HealthLabel.TextXAlignment = Enum.TextXAlignment.Left
HealthLabel.Parent = PotionFrame

local HealthInput = Instance.new("TextBox")
HealthInput.Name = "HealthInput"
HealthInput.Size = UDim2.new(0.9, 0, 0, 30)
HealthInput.Position = UDim2.new(0.05, 0, 0.24, 0)
HealthInput.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
HealthInput.BackgroundTransparency = 0.5
HealthInput.Text = tostring(potionHealthThreshold)
HealthInput.PlaceholderText = "Enter HP %"
HealthInput.TextColor3 = Color3.fromRGB(255, 255, 255)
HealthInput.Font = Enum.Font.Gotham
HealthInput.TextSize = 14
HealthInput.Parent = PotionFrame

local HealthInputCorner = Instance.new("UICorner")
HealthInputCorner.CornerRadius = UDim.new(0, 8)
HealthInputCorner.Parent = HealthInput

local Potion1Toggle = Instance.new("TextButton")
Potion1Toggle.Name = "Potion1Toggle"
Potion1Toggle.Size = UDim2.new(0.9, 0, 0, 35)
Potion1Toggle.Position = UDim2.new(0.05, 0, 0.42, 0)
Potion1Toggle.BackgroundColor3 = usePotion1 and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
Potion1Toggle.BackgroundTransparency = 0.6
Potion1Toggle.Text = "Use Potion 1"
Potion1Toggle.Font = Enum.Font.Gotham
Potion1Toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
Potion1Toggle.TextSize = 14
Potion1Toggle.Parent = PotionFrame

local Potion1Corner = Instance.new("UICorner")
Potion1Corner.CornerRadius = UDim.new(0, 8)
Potion1Corner.Parent = Potion1Toggle

local Potion2Toggle = Instance.new("TextButton")
Potion2Toggle.Name = "Potion2Toggle"
Potion2Toggle.Size = UDim2.new(0.9, 0, 0, 35)
Potion2Toggle.Position = UDim2.new(0.05, 0, 0.58, 0)
Potion2Toggle.BackgroundColor3 = usePotion2 and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
Potion2Toggle.BackgroundTransparency = 0.6
Potion2Toggle.Text = "Use Potion 2"
Potion2Toggle.Font = Enum.Font.Gotham
Potion2Toggle.TextColor3 = Color3.fromRGB(255, 255, 255)
Potion2Toggle.TextSize = 14
Potion2Toggle.Parent = PotionFrame

local Potion2Corner = Instance.new("UICorner")
Potion2Corner.CornerRadius = UDim.new(0, 8)
Potion2Corner.Parent = Potion2Toggle
    
    local SliderFrame = Instance.new("Frame")
SliderFrame.Name = "SliderFrame"
SliderFrame.Size = UDim2.new(0.9, 0, 0, 40)
SliderFrame.Position = UDim2.new(0.05, 0, 0.78, 0)
SliderFrame.BackgroundTransparency = 1
SliderFrame.Parent = MainFrame
    
    local SliderLabel = Instance.new("TextLabel")
    SliderLabel.Name = "SliderLabel"
    SliderLabel.Size = UDim2.new(1, 0, 0, 20)
    SliderLabel.Position = UDim2.new(0, 0, 0, 0)
    SliderLabel.BackgroundTransparency = 1
    SliderLabel.Text = "Mob Distance: " .. mobDistance
    SliderLabel.Font = Enum.Font.Gotham
    SliderLabel.TextColor3 = Color3.fromRGB(255, 255, 255)
    SliderLabel.TextSize = 12
    SliderLabel.Parent = SliderFrame
    
    local SliderTrack = Instance.new("Frame")
    SliderTrack.Name = "SliderTrack"
    SliderTrack.Size = UDim2.new(1, 0, 0, 4)
    SliderTrack.Position = UDim2.new(0, 0, 0.6, 0)
    SliderTrack.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    SliderTrack.BackgroundTransparency = 0.6
    SliderTrack.Parent = SliderFrame
    
    local UICorner_SliderTrack = Instance.new("UICorner")
    UICorner_SliderTrack.CornerRadius = UDim.new(0, 2)
    UICorner_SliderTrack.Parent = SliderTrack
    
    local SliderThumb = Instance.new("TextButton")
    SliderThumb.Name = "SliderThumb"
    SliderThumb.Size = UDim2.new(0, 12, 0, 12)
    SliderThumb.Position = UDim2.new((mobDistance - 1) / 14, -6, 0.5, -6)
    SliderThumb.BackgroundColor3 = Color3.fromRGB(80, 80, 80)
    SliderThumb.Text = ""
    SliderThumb.Parent = SliderTrack
    
    local UICorner_SliderThumb = Instance.new("UICorner")
    UICorner_SliderThumb.CornerRadius = UDim.new(1, 0)
    UICorner_SliderThumb.Parent = SliderThumb
    
    local DisableRenderButton = Instance.new("TextButton")
DisableRenderButton.Name = "DisableRenderButton"
DisableRenderButton.Size = UDim2.new(0.43, 0, 0, 30)
DisableRenderButton.Position = UDim2.new(0.285, 0, 0.65, 0)
DisableRenderButton.BackgroundColor3 = renderDisabled and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
DisableRenderButton.BackgroundTransparency = 0.6
DisableRenderButton.Text = "Disable Render"
DisableRenderButton.Font = Enum.Font.Gotham
DisableRenderButton.TextColor3 = Color3.fromRGB(255, 255, 255)
DisableRenderButton.TextSize = 12
DisableRenderButton.Parent = MainFrame

local UICorner_DisableRender = Instance.new("UICorner")
UICorner_DisableRender.CornerRadius = UDim.new(0, 8)
UICorner_DisableRender.Parent = DisableRenderButton

local BlackFrame = Instance.new("Frame")
BlackFrame.Name = "BlackFrame"
BlackFrame.Size = UDim2.new(1, 0, 1, 0)
BlackFrame.Position = UDim2.new(0, 0, 0, 0)
BlackFrame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
BlackFrame.BorderSizePixel = 0
BlackFrame.Visible = renderDisabled
BlackFrame.ZIndex = -9999999
BlackFrame.Parent = ScreenGui
    
    local dragStart = nil
    local startPos = nil
    local guiDragging = false
    local isDragging = false
    
    local function saveCurrentSettings()
    saveSettings({
        autoFarmEnabled = autoFarmEnabled,
        autoAttackEnabled = autoAttackEnabled,
        autoChestEnabled = autoChestEnabled,
        autoBuffEnabled = autoBuffEnabled,
        autoSkillEnabled = autoSkillEnabled,
        mobDistance = mobDistance,
        farmSpeed = farmSpeed,
        autoPotionEnabled = autoPotionEnabled,
        potionHealthThreshold = potionHealthThreshold,
        usePotion1 = usePotion1,
        usePotion2 = usePotion2,
        renderDisabled = renderDisabled
    })
end
    
    local function updateDrag(input)
        if guiDragging then
            local delta = input.Position - dragStart
            MainFrame.Position = UDim2.new(startPos.X.Scale, startPos.X.Offset + delta.X, startPos.Y.Scale, startPos.Y.Offset + delta.Y)
        end
    end
    
    local function updateSlider(pos)
        local sliderPos = pos - SliderTrack.AbsolutePosition.X
        local sliderSize = SliderTrack.AbsoluteSize.X
        local percentage = math.clamp(sliderPos / sliderSize, 0, 1)
        mobDistance = math.floor(1 + percentage * 14)
        SliderLabel.Text = "Mob Distance: " .. mobDistance
        SliderThumb.Position = UDim2.new(percentage, -6, 0.5, -6)
        saveCurrentSettings()
    end
    
    SliderThumb.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            isDragging = true
        end
    end)
    
    game:GetService("UserInputService").InputEnded:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or
            input.UserInputType == Enum.UserInputType.Touch then
            guiDragging = false
            isDragging = false
        end
    end)
    
    game:GetService("UserInputService").InputChanged:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseMovement or
            input.UserInputType == Enum.UserInputType.Touch then
            if isDragging then
                updateSlider(input.Position.X)
            elseif guiDragging then
                updateDrag(input)
            end
        end
    end)
    
    SliderTrack.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or 
           input.UserInputType == Enum.UserInputType.Touch then
            updateSlider(input.Position.X)
            isDragging = true
        end
    end)
    
    MainFrame.InputBegan:Connect(function(input)
        if input.UserInputType == Enum.UserInputType.MouseButton1 or input.UserInputType == Enum.UserInputType.Touch then
            if not isDragging then
                guiDragging = true
                dragStart = input.Position
                startPos = MainFrame.Position
            end
        end
    end)
    
    ToggleButton.MouseButton1Click:Connect(function()
        MainFrame.Visible = not MainFrame.Visible
    end)
    
    DiscordButton.MouseButton1Click:Connect(function()
        DiscordButton.BackgroundColor3 = Color3.fromRGB(120, 130, 255)
        setclipboard(discordLink)
        onMessage("Discord link copied!")
        task.wait(0.1)
        DiscordButton.BackgroundColor3 = Color3.fromRGB(88, 101, 242)
    end)
    
    spawn(function()
        while true do
            local args = {true}
            ReplicatedStorage:WaitForChild("remotes"):WaitForChild("block"):FireServer(unpack(args))
            wait()
        end
    end)
    
    spawn(function()
        while true do
            local args = {1}
            ReplicatedStorage:WaitForChild("remotes"):WaitForChild("plrUpgrade"):FireServer(unpack(args))
            wait(1)
        end
    end)
    
    spawn(function()
        while true do
            local args = {"replay"}
            ReplicatedStorage:WaitForChild("remotes"):WaitForChild("gameEndVote"):FireServer(unpack(args))
            wait(1)
        end
    end)
    
    spawn(function()
        while true do
            for i = 1, 3 do
                local args = {
                    "Claim",
                    "Quest_" .. i,
                    1
                }
                game:GetService("ReplicatedStorage"):WaitForChild("remotes"):WaitForChild("dailyQuestEvent"):FireServer(unpack(args))
            end
            wait(1)
        end
    end)
    
    spawn(function()
    while true do
        if autoChestEnabled then
            local chestTypes = {
                "WoodenChest",
                "RoyalChest",
                "GodlyChest",
                "SandyChest",
                "FossilChest",
                "RavenChest",
                "FrostChest",
                "FleshChest",
                "CrystalChest",
                "HellChest",
                "SamuraiChest",
                "LunarChest",
                "DailyChest",
                "ElectricChest"
            }
            
            for _, chestType in ipairs(chestTypes) do
                for level = 1, 9 do
                    pcall(function()
                        local chestName = chestType .. level
                        local args = {chestName, 1}
                        ReplicatedStorage:WaitForChild("remotes"):WaitForChild("openLoot"):InvokeServer(unpack(args))
                    end)
                end
            end
        end
        wait(0.5)
    end
end)

local function isInCutscene()
    local camera = workspace.CurrentCamera
    
    if camera.CameraType == Enum.CameraType.Scriptable then
        return true
    end

    return false
end

local function isInCombatZone()
    return Workspace:FindFirstChild("CombatZones") ~= nil
end
    
    spawn(function()
    while true do
        if autoBuffEnabled and not isInCombatZone() and not isInCutscene() then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") and nearestMob then
                local targetPart = nil
                
                if nearestMob.Name == "BookHand" then
                    targetPart = nearestMob:FindFirstChild("basehitbox")
                end
                
                if not targetPart then
                    targetPart = nearestMob:FindFirstChild("HumanoidRootPart") or nearestMob:FindFirstChild("10")
                end
                
                if targetPart then
                    local distance = (character.HumanoidRootPart.Position - targetPart.Position).Magnitude
                    
                    if distance <= (mobDistance + 3) then
                        local skills = {"titan", "berserk", "rejuvenate", "boneStrength", "adrenaline", "AngelsBane", "GoldenEclipse", "ablaze", "goldenArmy", "constellation", "lightning", "bloodSnowstorm", "sandTornado", "lunarSpell", "voidGrip", "bloodThirst", "smokebomb"}
                        for _, skill in ipairs(skills) do
                            pcall(function()
                                local args = {skill}
                                ReplicatedStorage:WaitForChild("remotes"):WaitForChild("useAbility"):FireServer(unpack(args))
                            end)
                        end
                    end
                end
            end
        end
        wait(0.5)
    end
end)

    local function setupNoClip()
        local character = LocalPlayer.Character
        if character then
            for _, descendant in pairs(character:GetDescendants()) do
                if descendant:IsA("BasePart") then
                    descendant.CanCollide = false
                end
            end
        end
    end
    
    spawn(function()
        while true do
            if autoFarmEnabled and not isInCombatZone() then
                setupNoClip()
            end
            wait(0.5)
        end
    end)
    
    spawn(function()
        RunService.Heartbeat:Connect(function()
            if autoFarmEnabled and not isInCombatZone() then
                local character = LocalPlayer.Character
                if character and character:FindFirstChild("HumanoidRootPart") then
                    character.HumanoidRootPart.Velocity = Vector3.new(0, 0, 0)
                    character.HumanoidRootPart.RotVelocity = Vector3.new(0, 0, 0)
                end
            end
        end)
    end)
    
    if autoFarmEnabled then
        task.spawn(function()
            task.wait(2)
            MainFrame.Visible = false
        end)
    end
    
    spawn(function()
    while true do
        if autoAttackEnabled and not isInCombatZone() and not isInCutscene() then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") and nearestMob then
                local targetPart = nil

                if nearestMob.Name == "BookHand" then
                    targetPart = nearestMob:FindFirstChild("basehitbox")
                end

                if not targetPart then
                    targetPart = nearestMob:FindFirstChild("HumanoidRootPart") or nearestMob:FindFirstChild("10")
                end
                
                if targetPart then
                    local distance = (character.HumanoidRootPart.Position - targetPart.Position).Magnitude
                    
                    if distance <= (mobDistance + 3) then
                        local success, attackButton = pcall(function()
                            return LocalPlayer.PlayerGui.gameUI.HUD.buttons.attack
                        end)
                        
                        if success and attackButton then
                            local buttonPosition = attackButton.AbsolutePosition
                            local buttonSize = attackButton.AbsoluteSize
                            local centerX = buttonPosition.X + (buttonSize.X / 2)
                            local centerY = buttonPosition.Y + (buttonSize.Y / 2)
                            
                            VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, true, game, 0)
                            wait(0.1)
                            VirtualInputManager:SendMouseButtonEvent(centerX, centerY, 0, false, game, 0)
                        end
                    end
                end
            end
        end
        wait(0.2)
    end
end)

spawn(function()
    while true do
        if autoSkillEnabled and not isInCombatZone() and not isInCutscene() then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") and nearestMob then
                local targetPart = nil

                if nearestMob.Name == "BookHand" then
                    targetPart = nearestMob:FindFirstChild("basehitbox")
                end

                if not targetPart then
                    targetPart = nearestMob:FindFirstChild("HumanoidRootPart") or nearestMob:FindFirstChild("10")
                end
                
                if targetPart then
                    local distance = (character.HumanoidRootPart.Position - targetPart.Position).Magnitude
                    
                    if distance <= (mobDistance + 3) then
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.E, false, game)
                        wait(0.1)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.E, false, game)
                        wait(0.1)
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.R, false, game)
                        wait(0.1)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.R, false, game)
                    end
                end
            end
        end
        wait(0.2)
    end
end)
    
local archerExists = Workspace:FindFirstChild("Archer") ~= nil or Workspace:FindFirstChild("CursedArcher") ~= nil
local skeletonExists = Workspace:FindFirstChild("CorruptSkeleton") ~= nil or Workspace:FindFirstChild("Skeleton") ~= nil
    
spawn(function()
    local currentTween = nil
    local noMobTimer = 0
    
    while true do
        if autoFarmEnabled and not isInCombatZone() then
            local character = LocalPlayer.Character
            if character and character:FindFirstChild("HumanoidRootPart") then
                
                if nearestMob then
                    local mobDead = false
                    
                    if not nearestMob.Parent then
                        mobDead = true
                    else
                        local mobHealth = nearestMob:FindFirstChild("Health")
                        if mobHealth then
                            if mobHealth.Value <= 0 then
                                mobDead = true
                            end
                        else
                            local targetPart = nearestMob:FindFirstChild("HumanoidRootPart")
                            if not targetPart and nearestMob.Name == "BookHand" then
                                targetPart = nearestMob:FindFirstChild("basehitbox")
                            end
                            if not targetPart and nearestMob.Name == "worm" then
                                targetPart = nearestMob:FindFirstChild("10")
                            end
                            if not targetPart or not targetPart.Parent then
                                mobDead = true
                            end
                        end
                    end
                    
                    if mobDead then
                        nearestMob = nil
                        if currentTween then
                            currentTween:Cancel()
                            currentTween = nil
                        end
                    end
                end

                if nearestMob and nearestMob.Name == "Korth" then
                    local throneRoom = Workspace:FindFirstChild("ThroneRoom")
                    if throneRoom then
                        for _, child in pairs(throneRoom:GetChildren()) do
                            if child.Name == "BookHand" and child:IsA("Model") then
                                local handHealth = child:FindFirstChild("Health")
                                if handHealth and handHealth.Value > 0 then
                                    local baseHitbox = child:FindFirstChild("basehitbox")
                                    if baseHitbox then
                                        nearestMob = child
                                        if currentTween then
                                            currentTween:Cancel()
                                            currentTween = nil
                                        end
                                        break
                                    end
                                end
                            end
                        end
                    end
                end
                
                if not nearestMob then
                    local shortestDistance = math.huge
                    local blenderModel = Workspace:FindFirstChild("blender")
                    local mobsFound = false
                    local korthExists = Workspace:FindFirstChild("Korth") ~= nil
                    local mobsWithAttribute = {}
                    local mobsWithoutAttribute = {}
                    
                    for _, mob in pairs(Workspace:GetChildren()) do
                        if mob:IsA("Model") then
                            local humanoid = mob:FindFirstChild("Humanoid")
                            local mobHealth = mob:FindFirstChild("Health")
                            local targetPart = mob:FindFirstChild("HumanoidRootPart")
                            local hadEntrance = mob:GetAttribute("hadEntrance")
                            
                            if humanoid and mobHealth and targetPart and mobHealth.Value > 0 and mob ~= character and mob.Name ~= "Clyde" and mob.Name ~= "Rig" and mob.Name ~= "TutorialClyde" and mob.Name ~= "MarkerVFX[Emit]" and mob.Name ~= "HaloArmorRig" and mob.Name ~= "blender" and mob.Name ~= "GoldenPhantom" and mob.Name ~= "Kori" and mob.Name ~= "Teeth_Trap" and mob.Name ~= "Korth" and mob.Name ~= "LocalKorth" then
                                local canTargetAkuma = true
                                
                                if mob.Name == "Akuma" then
                                    local akumaModel = Workspace:FindFirstChild("Akuma")
                                    if akumaModel then
                                        local healFolder = akumaModel:FindFirstChild("HealForceFieldFolder")
                                        if healFolder and #healFolder:GetChildren() > 0 then
                                            canTargetAkuma = false
                                        end
                                    end
                                end
                                
                                if canTargetAkuma then
                                    local distance = (character.HumanoidRootPart.Position - targetPart.Position).Magnitude
                                    
                                    if hadEntrance == true then
                                        table.insert(mobsWithAttribute, {mob = mob, distance = distance})
                                    else
                                        table.insert(mobsWithoutAttribute, {mob = mob, distance = distance})
                                    end
                                end
                            end
                        end
                    end
                    
                    local maneater = Workspace:FindFirstChild("Maneater")
                    if maneater then
                        local worm = maneater:FindFirstChild("worm")
                        if worm and worm:IsA("Model") then
                            local humanoid = worm:FindFirstChild("Humanoid")
                            local mobHealth = worm:FindFirstChild("Health")
                            local targetPart = worm:FindFirstChild("10")
                            
                            if humanoid and mobHealth and targetPart and mobHealth.Value > 0 then
                                local distance = (character.HumanoidRootPart.Position - targetPart.Position).Magnitude
                                local hadEntrance = worm:GetAttribute("hadEntrance")
                                
                                if hadEntrance == true then
                                    table.insert(mobsWithAttribute, {mob = worm, distance = distance})
                                else
                                    table.insert(mobsWithoutAttribute, {mob = worm, distance = distance})
                                end
                            end
                        end
                    end
                    
                    if #mobsWithAttribute > 0 then
                        table.sort(mobsWithAttribute, function(a, b) return a.distance < b.distance end)
                        nearestMob = mobsWithAttribute[1].mob
                        mobsFound = true
                        noMobTimer = 0
                    elseif #mobsWithoutAttribute > 0 then
                        table.sort(mobsWithoutAttribute, function(a, b) return a.distance < b.distance end)
                        nearestMob = mobsWithoutAttribute[1].mob
                        mobsFound = true
                        noMobTimer = 0
                    end
                    
                    if not nearestMob and korthExists then
                        local throneRoom = Workspace:FindFirstChild("ThroneRoom")
                        local bookHandFound = false
                        
                        if throneRoom then
                            local bookHands = throneRoom:GetChildren()
                            local bookHandToTarget = nil
                            local shortestBookHandDistance = math.huge
                            
                            for _, child in pairs(bookHands) do
                                if child.Name == "BookHand" and child:IsA("Model") then
                                    local bookHandHealth = child:FindFirstChild("Health")
                                    
                                    if bookHandHealth and bookHandHealth.Value > 0 then
                                        local baseHitbox = child:FindFirstChild("basehitbox")
                                        if baseHitbox and baseHitbox:IsA("BasePart") then
                                            bookHandFound = true
                                            local distance = (character.HumanoidRootPart.Position - baseHitbox.Position).Magnitude
                                            if distance < shortestBookHandDistance then
                                                shortestBookHandDistance = distance
                                                bookHandToTarget = child
                                            end
                                        end
                                    end
                                end
                            end
                            
                            if bookHandToTarget then
                                nearestMob = bookHandToTarget
                                noMobTimer = 0
                            end
                        end
                        
                        if not bookHandFound then
                            local korthModel = Workspace:FindFirstChild("Korth")
                            if korthModel and korthModel:IsA("Model") then
                                local korthHumanoid = korthModel:FindFirstChild("Humanoid")
                                local korthHealth = korthModel:FindFirstChild("Health")
                                local korthPart = korthModel:FindFirstChild("HumanoidRootPart")
                                
                                if korthHumanoid and korthHealth and korthPart and korthHealth.Value > 0 then
                                    nearestMob = korthModel
                                    noMobTimer = 0
                                end
                            end
                        end
                    end
                    
                    if not mobsFound and not korthExists then
                        noMobTimer = noMobTimer + 0.1
                        
                        if noMobTimer >= 8 then
                            if blenderModel then
                                local targetPos = Vector3.new(-764, -194, -231)
                                local distance = (character.HumanoidRootPart.Position - targetPos).Magnitude
                                local tweenInfo = TweenInfo.new(distance / farmSpeed, Enum.EasingStyle.Linear)
                                currentTween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = CFrame.new(targetPos)})
                                currentTween:Play()
                                currentTween.Completed:Wait()
                                wait(0.5)
                                
                                targetPos = Vector3.new(-732, -194, -233)
                                distance = (character.HumanoidRootPart.Position - targetPos).Magnitude
                                tweenInfo = TweenInfo.new(distance / farmSpeed, Enum.EasingStyle.Linear)
                                currentTween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = CFrame.new(targetPos)})
                                currentTween:Play()
                                currentTween.Completed:Wait()
                                wait(0.5)
                                noMobTimer = 0
                            else
                                if archerExists then
                                    local targetPos = Vector3.new(98, 28, 2019)
                                    local distance = (character.HumanoidRootPart.Position - targetPos).Magnitude
                                    local tweenInfo = TweenInfo.new(distance / farmSpeed, Enum.EasingStyle.Linear)
                                    currentTween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = CFrame.new(targetPos)})
                                    currentTween:Play()
                                    currentTween.Completed:Wait()
                                    wait(0.5)
                                    noMobTimer = 0
                                elseif skeletonExists then
                                    local targetPos = Vector3.new(109, 34, 2432)
                                    local distance = (character.HumanoidRootPart.Position - targetPos).Magnitude
                                    local tweenInfo = TweenInfo.new(distance / farmSpeed, Enum.EasingStyle.Linear)
                                    currentTween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = CFrame.new(targetPos)})
                                    currentTween:Play()
                                    currentTween.Completed:Wait()
                                    wait(0.5)
                                    noMobTimer = 0
                                else
                                    local nearestCampfire = nil
                                    local shortestCampfireDistance = math.huge
                                    
                                    for _, descendant in pairs(Workspace:GetDescendants()) do
                                        if descendant.Name == "Campfire" and descendant:IsA("Model") then
                                            local parent = descendant.Parent
                                            if parent and parent.Name == "CamnpfireRocky" then
                                                local parts = {}
                                                for _, child in pairs(descendant:GetDescendants()) do
                                                    if child:IsA("BasePart") then
                                                        table.insert(parts, child)
                                                    end
                                                end
                                                
                                                if #parts > 0 then
                                                    local campfireCenter = Vector3.new(0, 0, 0)
                                                    for _, part in pairs(parts) do
                                                        campfireCenter = campfireCenter + part.Position
                                                    end
                                                    campfireCenter = campfireCenter / #parts
                                                    
                                                    local distance = (character.HumanoidRootPart.Position - campfireCenter).Magnitude
                                                    if distance < shortestCampfireDistance then
                                                        shortestCampfireDistance = distance
                                                        nearestCampfire = descendant
                                                    end
                                                end
                                            end
                                        end
                                    end
                                    
                                    if nearestCampfire then
                                        local parts = {}
                                        for _, child in pairs(nearestCampfire:GetDescendants()) do
                                            if child:IsA("BasePart") then
                                                table.insert(parts, child)
                                            end
                                        end
                                        
                                        if #parts > 0 then
                                            local randomPart = parts[math.random(1, #parts)]
                                            local targetPosition = randomPart.Position
                                            local distance = (character.HumanoidRootPart.Position - targetPosition).Magnitude
                                            local tweenInfo = TweenInfo.new(distance / farmSpeed, Enum.EasingStyle.Linear)
                                            currentTween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = CFrame.new(targetPosition)})
                                            currentTween:Play()
                                            currentTween.Completed:Wait()
                                            wait(0.5)
                                        end
                                    end
                                    noMobTimer = 0
                                end
                            end
                        end
                    end
                else
                    noMobTimer = 0
                end
                
                if nearestMob and nearestMob.Name ~= "BookHand" and nearestMob.Name ~= "Korth" and nearestMob.Name ~= "worm" then
                    local hadEntrance = nearestMob:GetAttribute("hadEntrance")
                    
                    if hadEntrance == false or hadEntrance == nil then
                        local hasAnyActiveMobs = false
                        for _, mob in pairs(Workspace:GetChildren()) do
                            if mob:IsA("Model") and mob:GetAttribute("hadEntrance") == true and mob.Name ~= "Clyde" and mob.Name ~= "Rig" and mob.Name ~= "TutorialClyde" and mob.Name ~= "MarkerVFX[Emit]" and mob.Name ~= "HaloArmorRig" and mob.Name ~= "blender" and mob.Name ~= "GoldenPhantom" and mob.Name ~= "Kori" and mob.Name ~= "Teeth_Trap" and mob.Name ~= "Korth" and mob.Name ~= "LocalKorth" then
                                local mobHealth = mob:FindFirstChild("Health")
                                if mobHealth and mobHealth.Value > 0 then
                                    hasAnyActiveMobs = true
                                    break
                                end
                            end
                        end
                        
                        if hasAnyActiveMobs then
                            nearestMob = nil
                        end
                    end
                end
                
                if nearestMob then
                    local targetPart = nil
                    
                    if nearestMob.Name == "BookHand" then
                        targetPart = nearestMob:FindFirstChild("basehitbox")
                    elseif nearestMob.Name == "worm" then
                        targetPart = nearestMob:FindFirstChild("10")
                    else
                        targetPart = nearestMob:FindFirstChild("HumanoidRootPart")
                        if not targetPart then
                            targetPart = nearestMob:FindFirstChild("09")
                        end
                    end
                    
                    if targetPart then
                        local mobCFrame = targetPart.CFrame
                        local behindPosition = mobCFrame * CFrame.new(0, 0, mobDistance)
                        local distance = (character.HumanoidRootPart.Position - behindPosition.Position).Magnitude
                        
                        if distance > 60 then
                            if not currentTween or currentTween.PlaybackState ~= Enum.PlaybackState.Playing then
                                local tweenInfo = TweenInfo.new(distance / farmSpeed, Enum.EasingStyle.Linear)
                                currentTween = TweenService:Create(character.HumanoidRootPart, tweenInfo, {CFrame = behindPosition})
                                currentTween:Play()
                            end
                        else
                            if currentTween then
                                currentTween:Cancel()
                                currentTween = nil
                            end
                            character.HumanoidRootPart.CFrame = behindPosition
                        end
                    end
                end
            end
        else
            if currentTween then
                currentTween:Cancel()
                currentTween = nil
            end
            noMobTimer = 0
        end
        wait(0.1)
    end
end)

local function setupInitialCleanup()
    pcall(function()
        local upgradeFrame = game:GetService("Players").LocalPlayer.PlayerGui:FindFirstChild("gameUI")
        if upgradeFrame then
            local frame = upgradeFrame:FindFirstChild("upgradeFrame")
            if frame then
                frame.Visible = false
            end
        end
        
        local lighting = game:GetService("Lighting")
        local screenBlur = lighting:FindFirstChild("screenBlur")
        if screenBlur then
            screenBlur:Destroy()
        end
        
        local deathBlur = lighting:FindFirstChild("deathBlur")
        if deathBlur then
            deathBlur:Destroy()
        end
    end)
end

setupInitialCleanup()

spawn(function()
    while true do
        if autoPotionEnabled and (usePotion1 or usePotion2) then
            local playerHealth = game:GetService("Players").LocalPlayer.health
            local playerMaxHealth = game:GetService("Players").LocalPlayer.health.maxHealth
            
            if playerHealth and playerMaxHealth then
                local healthPercent = (playerHealth.Value / playerMaxHealth.Value) * 100
                if healthPercent <= potionHealthThreshold then
                    if usePotion1 then
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.One, false, game)
                        wait(0.05)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.One, false, game)
                    end
                    if usePotion2 then
                        wait(0.1)
                        VirtualInputManager:SendKeyEvent(true, Enum.KeyCode.Two, false, game)
                        wait(0.05)
                        VirtualInputManager:SendKeyEvent(false, Enum.KeyCode.Two, false, game)
                    end
                    wait(1)
                end
            end
        end
        wait(0.5)
    end
end)

DisableRenderButton.MouseButton1Click:Connect(function()
    renderDisabled = not renderDisabled
    if renderDisabled then
        DisableRenderButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
        BlackFrame.Visible = true
        game:GetService("RunService"):Set3dRenderingEnabled(false)
    else
        DisableRenderButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        BlackFrame.Visible = false
        game:GetService("RunService"):Set3dRenderingEnabled(true)
    end
    saveCurrentSettings()
end)

if renderDisabled then
    game:GetService("RunService"):Set3dRenderingEnabled(false)
end
    
    AutoFarmButton.MouseButton1Click:Connect(function()
        autoFarmEnabled = not autoFarmEnabled
        if autoFarmEnabled then
            AutoFarmButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
            task.spawn(function()
                task.wait(2)
                if autoFarmEnabled then
                    MainFrame.Visible = false
                end
            end)
        else
            AutoFarmButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        end
        saveCurrentSettings()
    end)
    
    AutoPotionButton.MouseButton1Click:Connect(function()
    PotionFrame.Visible = not PotionFrame.Visible
end)

HealthInput.FocusLost:Connect(function()
    local value = tonumber(HealthInput.Text)
    if value and value >= 1 and value <= 100 then
        potionHealthThreshold = value
        HealthLabel.Text = "Health Threshold: " .. potionHealthThreshold .. "%"
        saveCurrentSettings()
    else
        HealthInput.Text = tostring(potionHealthThreshold)
    end
end)

Potion1Toggle.MouseButton1Click:Connect(function()
    usePotion1 = not usePotion1
    Potion1Toggle.BackgroundColor3 = usePotion1 and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
    if usePotion1 or usePotion2 then
        autoPotionEnabled = true
        AutoPotionButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
    else
        autoPotionEnabled = false
        AutoPotionButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    end
    saveCurrentSettings()
end)

Potion2Toggle.MouseButton1Click:Connect(function()
    usePotion2 = not usePotion2
    Potion2Toggle.BackgroundColor3 = usePotion2 and Color3.fromRGB(70, 90, 180) or Color3.fromRGB(30, 30, 30)
    if usePotion1 or usePotion2 then
        autoPotionEnabled = true
        AutoPotionButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
    else
        autoPotionEnabled = false
        AutoPotionButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    end
    saveCurrentSettings()
end)
    
    AutoAttackButton.MouseButton1Click:Connect(function()
        autoAttackEnabled = not autoAttackEnabled
        if autoAttackEnabled then
            AutoAttackButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
        else
            AutoAttackButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        end
        saveCurrentSettings()
    end)
    
    AutoSkillButton.MouseButton1Click:Connect(function()
    autoSkillEnabled = not autoSkillEnabled
    if autoSkillEnabled then
        AutoSkillButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
    else
        AutoSkillButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
    end
    saveCurrentSettings()
end)
    
    AutoChestButton.MouseButton1Click:Connect(function()
        autoChestEnabled = not autoChestEnabled
        if autoChestEnabled then
            AutoChestButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
        else
            AutoChestButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        end
        saveCurrentSettings()
    end)
    
    AutoBuffButton.MouseButton1Click:Connect(function()
        autoBuffEnabled = not autoBuffEnabled
        if autoBuffEnabled then
            AutoBuffButton.BackgroundColor3 = Color3.fromRGB(70, 90, 180)
        else
            AutoBuffButton.BackgroundColor3 = Color3.fromRGB(30, 30, 30)
        end
        saveCurrentSettings()
    end)
    
end
    
local function verifyKey(key)
    local hwid = getHWID()
    
    local success, response = pcall(function()
        local url = API_URL .. "/api/verify?key=" .. HttpService:UrlEncode(key) .. "&hwid=" .. HttpService:UrlEncode(hwid)
        return fRequest({
            Url = url,
            Method = "GET"
        })
    end)
    
    if not success then
        onMessage("Connection error! Try using VPN")
        return false
    end
    
    if not response.Success or response.StatusCode ~= 200 then
        onMessage("Cannot reach server! Try using VPN")
        return false
    end
    
    local parseSuccess, data = pcall(function()
        return HttpService:JSONDecode(response.Body)
    end)
    
    if parseSuccess and data then
        if data.status == "success" then
            return true
        elseif data.status == "hwid_mismatch" then
            onMessage("Key is bound to another device!")
            return false
        elseif data.status == "invalid" then
            onMessage("Invalid key! " .. (data.message or ""))
            return false
        else
            onMessage("Error: " .. (data.message or "Unknown error"))
            return false
        end
    else
        onMessage("Server response error! Try again later")
        return false
    end
end

local function checkSavedKey()
    if scriptLoaded or invalidKeySaved then return false end
    
    if isfile("kinayosave/kinayokey.txt") then
        local savedKey = readfile("kinayosave/kinayokey.txt")
        local isValid = verifyKey(savedKey)
        
        if isValid then
            scriptLoaded = true
            onMessage("Saved key is valid. Starting script...")
            loadMainScript()
            return true
        else
            invalidKeySaved = true
        end
    end
    return false
end

task.spawn(function()
    while wait(0.5) do 
        if checkSavedKey() then
            break
        end
    end
end)

VerifyButton.MouseButton1Click:Connect(function()
    local inputKey = KeyBox.Text:gsub("%s+", "")
    if inputKey == "" then
        onMessage("Please enter a key!")
        return
    end
    
    local isValid = verifyKey(inputKey)
    
    if isValid then
        scriptLoaded = true
        writefile("kinayosave/kinayokey.txt", inputKey)
        onMessage("Key verified successfully!")
        loadMainScript()
    end
end)

loadMainScript()
